#!/bin/bash

dotfiles="aliases gitconfig gitmodules hushlogin vimrc zshrc bin"
dir="$(git rev-parse --show-toplevel)"

green="$(tput setaf 2)"
red="$(tput setaf 1)"
yellow="$(tput setaf 3)"
nc="$(tput sgr0)"

# Install Vundle
if [[ ! -e ~/.vim/bundle/Vundle.vim ]]; then

    prompt="$(printf "\n%s" "${yellow}Vundle not found. Would you like to install it? y/n: ${nc}")"
    read -ep "$prompt" ans
    case "$ans" in
        y|Y) git clone https://github.com/gmarik/Vundle.vim.git ~/.vim/bundle/Vundle
             vundle="1"
             vim +PluginInstall +qall
             ;;
        *)  true
            vundle="0"
            ## Add bit in here to link non-vundle .vimrc instead of normal one.
            ;;
    esac

fi

# Create symbolic link for dotfiles.
# These are statically set for now so as to keep things under control.
cd "$HOME"
for file in $dotfiles; do
    printf "%s" "Linking $file to \"${HOME}/.${file}\": "
    if [[ -e ${dir}/${file} ]]; then
        if ln -fFs "${dir}/${file}" ".${file}"; then
            printf "%s\n" "${green}OK${nc}"
        else
            printf "%s\n" "${red}FAIL - 'ln' error${nc}"
        fi
    else
        printf "%s\n" "${red}FAIL -- Can't find source file${nc}"
    fi
done

# Setup Vundle plugins
if [[ $vundle == 1 ]]; then
    printf "%s\n" "${yellow}Setting up Vundle plugins"
    vim +PluginInstall +qall
    printf "\n"
fi
